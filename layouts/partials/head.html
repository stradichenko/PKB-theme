<head>
    {{/* SEO Critical Resources - Must come first */}}
    {{ partial "seo/preload-resources.html" . }}
    
    {{/* Consolidated Meta Tags with SEO */}}
    {{ partial "head/meta.html" . }}
    
    {{/* Structured Data */}}
    {{ partial "seo/schema-org.html" . }}
    
    <!-- Favicon and Apple Touch Icon -->
    {{ partial "head/favicons.html" . }}
    
    <!-- Critical CSS -->
    {{ partial "head/critical-css.html" . }}
    
    <!-- Main Stylesheet -->
    {{ partial "head/styles.html" . }}
    
    {{/* Math Support - Load early for better rendering */}}
    {{- if .Params.math -}}
    <!-- KaTeX CSS - Preload for better performance -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"></noscript>
    
    <!-- KaTeX JS - Load with high priority -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" as="script">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" as="script">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/mhchem.min.js" as="script">
    {{- end -}}

    <!-- Site Verification Meta Tags -->
    {{ with site.Params.seo.google_site_verification }}
    <meta name="google-site-verification" content="{{ . }}">
    {{ end }}
    {{ with site.Params.seo.bing_verification }}
    <meta name="msvalidate.01" content="{{ . }}">
    {{ end }}
    {{ with site.Params.seo.yandex_verification }}
    <meta name="yandex-verification" content="{{ . }}">
    {{ end }}

    <!-- Include analytics scripts -->
    {{ partial "analytics.html" . }}

    <!-- JavaScript loading - Deferred for performance -->
    {{ with resources.Get "js/main.js" }}
        {{ $mainJS := . | js.Build | minify | fingerprint }}
        <script src="{{ $mainJS.RelPermalink }}" integrity="{{ $mainJS.Data.Integrity }}" crossorigin="anonymous" defer></script>
    {{ end }}
    
    <!-- PDF Generator -->
    {{ $pdfJS := resources.Get "js/pdf-generator.js" | minify | fingerprint }}
    <script src="{{ $pdfJS.RelPermalink }}" integrity="{{ $pdfJS.Data.Integrity }}" crossorigin="anonymous" defer></script>
    
    <!-- Load scrollbar fade functionality -->
    {{ $scrollbarFadeJS := resources.Get "js/scrollbar-fade.js" | minify }}
    <script src="{{ $scrollbarFadeJS.RelPermalink }}" defer></script>

    {{/* Math rendering scripts - Load after DOM is ready */}}
    {{- if .Params.math -}}
    <!-- KaTeX JS -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>

    <!-- KaTeX mhchem extension for chemical equations -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/mhchem.min.js" integrity="sha384-ifpG+NlgMq0kvOSGqGQxW1mJKpjjMDmZdpKGq3tbvD3WPhyshCEEYClriK/wRVU0" crossorigin="anonymous"></script>

    <!-- KaTeX auto-render extension -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>

    <!-- KaTeX Configuration -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            throwOnError: false,
            errorColor: '#cc0000',
            strict: false,
            trust: true,
        });
    });
    </script>
    {{- end -}}
</head>