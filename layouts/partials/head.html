<head>
    {{/* SEO Critical Resources - Must come first */}}
    {{ partial "seo/preload-resources.html" . }}

    {{/* Consolidated Meta Tags with SEO */}}
    {{ partial "head/meta.html" . }}

    {{/* Structured Data */}}
    {{ partial "seo/schema-org.html" . }}

    <!-- Favicon and Apple Touch Icon -->
    {{ partial "head/favicons.html" . }}

    <!-- Critical CSS -->
    {{ partial "head/critical-css.html" . }}

    <!-- Main Stylesheet -->
    {{ partial "head/styles.html" . }}

    <!-- Site Verification Meta Tags -->
    {{ with site.Params.seo.google_site_verification }}
      <meta name="google-site-verification" content="{{ . }}">
    {{ end }}
    {{ with site.Params.seo.bing_verification }}
      <meta name="msvalidate.01" content="{{ . }}">
    {{ end }}
    {{ with site.Params.seo.yandex_verification }}
      <meta name="yandex-verification" content="{{ . }}">
    {{ end }}

    <!-- Main JavaScript (minified & fingerprinted) -->
    {{ with resources.Get "js/main.js" }}
      {{ $mainJS := . | js.Build | minify | fingerprint }}
      <script src="{{ $mainJS.RelPermalink }}" integrity="{{ $mainJS.Data.Integrity }}" crossorigin="anonymous" defer></script>
    {{ end }}

    <!-- PDF Generator -->
    {{ with resources.Get "js/pdf-generator.js" }}
      {{ $pdfJS := . | minify | fingerprint }}
      <script src="{{ $pdfJS.RelPermalink }}" integrity="{{ $pdfJS.Data.Integrity }}" crossorigin="anonymous" defer></script>
    {{ end }}

    <!-- Scrollbar Fade -->
    {{ with resources.Get "js/scrollbar-fade.js" }}
      {{ $scrollbarFadeJS := . | minify }}
      <script src="{{ $scrollbarFadeJS.RelPermalink }}" defer></script>
    {{ end }}

    <!-- Page-specific JavaScript -->
    {{ if eq .Type "posts" }}
      {{ with resources.Get "js/posts.js" }}
        {{ $postsJS := . | js.Build | minify | fingerprint }}
        <script src="{{ $postsJS.RelPermalink }}" integrity="{{ $postsJS.Data.Integrity }}" crossorigin="anonymous" defer></script>
      {{ end }}
    {{ end }}

    {{ if .Params.search }}
      {{ with resources.Get "js/search.js" }}
        {{ $searchJS := . | js.Build | minify | fingerprint }}
        <script src="{{ $searchJS.RelPermalink }}" integrity="{{ $searchJS.Data.Integrity }}" crossorigin="anonymous" defer></script>
      {{ end }}
    {{ end }}

    {{ partial "analytics/matomo.html" . }}
      <script async src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0/dist/tf.min.js"></script>
      <script async src="https://d3js.org/d3.v7.min.js"></script>

</head>
