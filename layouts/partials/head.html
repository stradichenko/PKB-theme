<!-- Sets the character encoding for the document to UTF-8 -->
<meta charset="utf-8">

<!-- Favicons -->

<!-- Basic Favicon -->
<link rel="icon" type="image/png" href="{{ relURL "favicon.png" }}" />
<link rel="icon" type="image/png" href="{{ relURL "my-favicon/favicon-96x96.png" }}" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="{{ relURL "my-favicon/favicon.svg" }}" />
<link rel="shortcut icon" href="{{ relURL "my-favicon/favicon.ico" }}" />
<link rel="apple-touch-icon" sizes="180x180" href="{{ relURL "my-favicon/apple-touch-icon.png" }}" />
<meta name="apple-mobile-web-app-title" content="MyWebSite" />

<!-- Web Manifest -->
<link rel="manifest" href="{{ relURL "my-favicon/site.webmanifest" }}">

<!-- RSS Feed -->
<link rel="alternate" type="application/rss+xml" href="{{ .Site.BaseURL }}index.xml" title="{{ .Site.Title }}">

<!-- Ensures proper rendering and touch zooming on mobile devices -->
<meta name="viewport" content="width=device-width">

<!-- Dynamically sets the page title -->
<title>{{ if .IsHome }}{{ site.Title }}{{ else }}{{ printf "%s | %s" .Title site.Title }}{{ end }}</title>
<meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ with .Summary }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}{{ end }}">

<!-- Critical theme initialization script -->
<script>
  (function() {
    const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    const currentTheme = localStorage.getItem('theme') || 
                       (prefersDarkScheme.matches ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', currentTheme);
    document.documentElement.style.backgroundColor = 
      currentTheme === 'dark' ? '#1a202c' : '#275f85';
    document.documentElement.style.color = 
      currentTheme === 'dark' ? '#e2e8ff' : '#cad6ff';
  })();
</script>

<!-- Include critical JS first -->
{{ $criticalJS := resources.Get "js/critical.js" | js.Build | minify }}
<script>{{ $criticalJS.Content | safeJS }}</script>

<!-- INLINE CRITICAL SELECTION STYLES FOR IMMEDIATE APPLICATION -->
<style>
  /* Text selection highlighting with maximum specificity */
  *::selection {
    background-color: var(--color-primary, #4a90e2) !important;
    color: var(--color-white, #ffffff) !important;
    text-shadow: none !important;
  }
  
  *::-moz-selection {
    background-color: var(--color-primary, #4a90e2) !important;
    color: var(--color-white, #ffffff) !important;
    text-shadow: none !important;
  }
  
  /* Dark mode needs separate rules */
  html[data-theme="dark"] *::selection {
    background-color: #e9996b !important;
    color: #1a2633 !important;
  }
  
  html[data-theme="dark"] *::-moz-selection {
    background-color: #e9996b !important;
    color: #1a2633 !important;
  }
</style>

<!-- CENTRALIZED CSS LOADING - Proper cascade order -->
{{ if eq hugo.Environment "development" }}
  <!-- Development mode - Individual CSS files with source maps -->
  
  <!-- Critical CSS first -->
  <!-- 1. Core styles -->
  {{ with resources.Get "css/global/variables.css" }}
    {{ $variablesCSS := . | fingerprint }}
    <link rel="stylesheet" href="{{ $variablesCSS.RelPermalink }}" integrity="{{ $variablesCSS.Data.Integrity }}" crossorigin="anonymous">
  {{ end }}
  
  {{ with resources.Get "css/global/reset.css" }}
    {{ $resetCSS := . | fingerprint }}
    <link rel="stylesheet" href="{{ $resetCSS.RelPermalink }}" integrity="{{ $resetCSS.Data.Integrity }}" crossorigin="anonymous">
  {{ end }}

  <!-- 2. Layout components -->
  {{ with resources.Get "css/body.css" }}
    {{ $bodyCSS := . | fingerprint }}
    <link rel="stylesheet" href="{{ $bodyCSS.RelPermalink }}" integrity="{{ $bodyCSS.Data.Integrity }}" crossorigin="anonymous">
  {{ end }}
  
  {{ with resources.Get "css/header.css" }}
    {{ $headerCSS := . | fingerprint }}
    <link rel="stylesheet" href="{{ $headerCSS.RelPermalink }}" integrity="{{ $headerCSS.Data.Integrity }}" crossorigin="anonymous">
  {{ end }}
  
  {{ with resources.Get "css/footer.css" }}
    {{ $footerCSS := . | fingerprint }}
    <link rel="stylesheet" href="{{ $footerCSS.RelPermalink }}" integrity="{{ $footerCSS.Data.Integrity }}" crossorigin="anonymous">
  {{ end }}
  
  <!-- 3. Component styles -->
  {{ with resources.Get "css/sidenotes.css" }}
    {{ $sidenotesCSS := . | fingerprint }}
    <link rel="stylesheet" href="{{ $sidenotesCSS.RelPermalink }}" integrity="{{ $sidenotesCSS.Data.Integrity }}" crossorigin="anonymous">
  {{ end }}
  
  {{ $tocCSS := resources.Get "css/components/toc.css" | fingerprint }}
  <link rel="stylesheet" href="{{ $tocCSS.RelPermalink }}" integrity="{{ $tocCSS.Data.Integrity }}" crossorigin="anonymous">
  
  {{ $tableCSS := resources.Get "css/components/table.css" | fingerprint }}
  <link rel="stylesheet" href="{{ $tableCSS.RelPermalink }}" integrity="{{ $tableCSS.Data.Integrity }}" crossorigin="anonymous">
  
  {{ $blockquoteCSS := resources.Get "css/components/blockquote.css" | fingerprint }}
  <link rel="stylesheet" href="{{ $blockquoteCSS.RelPermalink }}" integrity="{{ $blockquoteCSS.Data.Integrity }}" crossorigin="anonymous">
  
  {{ $citationCSS := resources.Get "css/components/citation.css" | fingerprint }}
  <link rel="stylesheet" href="{{ $citationCSS.RelPermalink }}" integrity="{{ $citationCSS.Data.Integrity }}" crossorigin="anonymous">
  
  {{ $knowledgeGraphCSS := resources.Get "css/components/knowledge-graph.css" | fingerprint }}
  <link rel="stylesheet" href="{{ $knowledgeGraphCSS.RelPermalink }}" integrity="{{ $knowledgeGraphCSS.Data.Integrity }}" crossorigin="anonymous">
  
  {{ with resources.Get "css/components/code.css" }}
    {{ $codeCSS := . | fingerprint }}
    <link rel="stylesheet" href="{{ $codeCSS.RelPermalink }}" integrity="{{ $codeCSS.Data.Integrity }}" crossorigin="anonymous">
  {{ end }}
  
  {{ with resources.Get "css/components/markdown.css" }}
    {{ $markdownCSS := . | fingerprint }}
    <link rel="stylesheet" href="{{ $markdownCSS.RelPermalink }}" integrity="{{ $markdownCSS.Data.Integrity }}" crossorigin="anonymous">
  {{ end }}
  
  {{ $listCSS := resources.Get "css/list.css" | fingerprint }}
  <link rel="stylesheet" href="{{ $listCSS.RelPermalink }}" integrity="{{ $listCSS.Data.Integrity }}" crossorigin="anonymous">
  
  {{ $filtersCSS := resources.Get "css/filters.css" | fingerprint }}
  <link rel="stylesheet" href="{{ $filtersCSS.RelPermalink }}" integrity="{{ $filtersCSS.Data.Integrity }}" crossorigin="anonymous">
  
  {{ $postsGridCSS := resources.Get "css/components/recent-posts-grid.css" | fingerprint }}
  <link rel="stylesheet" href="{{ $postsGridCSS.RelPermalink }}" integrity="{{ $postsGridCSS.Data.Integrity }}" crossorigin="anonymous">
  
  {{ $aboutProfileCSS := resources.Get "css/about-profile.css" | fingerprint }}
  <link rel="stylesheet" href="{{ $aboutProfileCSS.RelPermalink }}" integrity="{{ $aboutProfileCSS.Data.Integrity }}" crossorigin="anonymous">
  
  <!-- 4. Main CSS last -->
  {{ $mainCSS := resources.Get "css/main.css" | fingerprint }}
  <link rel="stylesheet" href="{{ $mainCSS.RelPermalink }}" integrity="{{ $mainCSS.Data.Integrity }}" crossorigin="anonymous">
  
  <!-- 5. Replace SCSS with regular CSS -->
  {{ with resources.Get "css/search.css" }}
    {{ $searchCSS := . | fingerprint }}
    <link rel="stylesheet" href="{{ $searchCSS.RelPermalink }}" integrity="{{ $searchCSS.Data.Integrity }}" crossorigin="anonymous">
  {{ end }}
  
  <!-- 6. Theme toggle CSS - LOAD LAST to ensure overrides work -->
  {{ $themeToggleCSS := resources.Get "css/theme-toggle.css" | fingerprint }}
  <link rel="stylesheet" href="{{ $themeToggleCSS.RelPermalink }}" integrity="{{ $themeToggleCSS.Data.Integrity }}" crossorigin="anonymous">

  <!-- Contribution calendar CSS -->
  {{ $contributionCalendarCSS := resources.Get "css/contribution-calendar.css" | minify }}
  <link rel="stylesheet" href="{{ $contributionCalendarCSS.Permalink }}">
{{ else }}
  <!-- Production mode - Concatenated and minified CSS -->
  {{ $cssFiles := slice 
      (resources.Get "css/global/variables.css")
      (resources.Get "css/global/reset.css")
      (resources.Get "css/body.css")
      (resources.Get "css/header.css") 
      (resources.Get "css/footer.css")
      (resources.Get "css/sidenotes.css")
      (resources.Get "css/components/toc.css")
      (resources.Get "css/components/table.css")
      (resources.Get "css/components/blockquote.css")
      (resources.Get "css/components/citation.css")
      (resources.Get "css/components/code.css")
      (resources.Get "css/components/markdown.css")
      (resources.Get "css/list.css")
      (resources.Get "css/filters.css")
      (resources.Get "css/components/recent-posts-grid.css")
      (resources.Get "css/about-profile.css")
      (resources.Get "css/main.css")
  }}
  {{ $combinedCSS := $cssFiles | resources.Concat "css/all.css" | minify | fingerprint }}
  <link rel="stylesheet" href="{{ $combinedCSS.RelPermalink }}" integrity="{{ $combinedCSS.Data.Integrity }}" crossorigin="anonymous">
  
  <!-- Include regular CSS -->
  {{ with resources.Get "css/search.css" }}
    {{ $searchCSS := . | minify | fingerprint }}
    <link rel="stylesheet" href="{{ $searchCSS.RelPermalink }}" integrity="{{ $searchCSS.Data.Integrity }}" crossorigin="anonymous">
  {{ end }}
  
  <!-- Load theme-toggle CSS last to ensure it overrides all other styles -->
  {{ $themeToggleCSS := resources.Get "css/theme-toggle.css" | minify | fingerprint }}
  <link rel="stylesheet" href="{{ $themeToggleCSS.RelPermalink }}" integrity="{{ $themeToggleCSS.Data.Integrity }}" crossorigin="anonymous">

  <!-- Contribution calendar CSS -->
  {{ $contributionCalendarCSS := resources.Get "css/contribution-calendar.css" | minify }}
  <link rel="stylesheet" href="{{ $contributionCalendarCSS.Permalink }}">
{{ end }}

<!-- JavaScript loading -->
{{ with resources.Get "js/main.js" }}
  {{ $mainJS := . | js.Build | minify | fingerprint }}
  <script src="{{ $mainJS.RelPermalink }}" integrity="{{ $mainJS.Data.Integrity }}" crossorigin="anonymous"></script>
{{ end }}

<!-- Include analytics scripts -->
{{ partial "analytics.html" . }}
</head>