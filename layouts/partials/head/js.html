<!-- Theme initialization script - must run BEFORE CSS loads to avoid FOUC -->
<script>
  (function() {
    const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    const currentTheme = localStorage.getItem('theme') || 
                         (prefersDarkScheme.matches ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', currentTheme);
    
    // Prevent flash of incorrect theme background
    document.documentElement.style.backgroundColor = 
      currentTheme === 'dark' ? '#1a202c' : '#275f85';
  })();
</script>

<!-- Inline critical JS for performance -->
{{ $criticalJS := resources.Get "js/critical.js" }}
{{ if $criticalJS }}
  <script>{{ $criticalJS.Content | safeJS }}</script>
{{ end }}

<!-- Main JS bundle using cache -->
{{ $mainJSFiles := slice "js/main.js" }}
{{ if .Params.search }}
  {{ $mainJSFiles = $mainJSFiles | append "js/search.js" }}
{{ end }}

{{ partial "cache/resource-cache.html" (dict 
  "bundleKey" "main-scripts"
  "resources" $mainJSFiles
  "type" "js"
  "minify" true
) }}
