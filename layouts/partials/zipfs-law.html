<div class="about-profile-container">
  <div class="zipf-box">
    <h2 class="zipf-title">Content Analysis (Zipf's Law)</h2>
    
    <div class="zipf-container">
      <div class="zipf-graph">
        <h3>Word Frequency Distribution</h3>
        <!-- Wrapper for chart with relative positioning -->
        <div class="zipf-chart-wrapper">
          <div id="zipf-chart"></div>
          
          <!-- Action buttons positioned on top right -->
          <div class="zipf-graph-actions">
            <!-- Legend will automatically be positioned at the right due to flex-direction: row-reverse -->
            
            <!-- Fullscreen button -->
            <button id="zipf-fullscreen-button" class="zipf-fullscreen-button" aria-label="View graph in fullscreen">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1h-4zM10 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 16 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5zM.5 10a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 0 14.5v-4a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v4a1.5 1.5 0 0 1-1.5 1.5h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5z"/>
              </svg>
            </button>
            
            <!-- Save button dropdown -->
            <div class="zipf-save-dropdown">
              <button id="zipf-save-button" class="zipf-save-button" aria-label="Save graph as image" aria-expanded="false" aria-controls="zipf-save-options">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                  <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                </svg>
              </button>
              <div id="zipf-save-options" class="zipf-save-options">
                <button class="zipf-save-option" data-format="png">Save as PNG</button>
                <button class="zipf-save-option" data-format="svg">Save as SVG</button>
                <button class="zipf-save-option" data-format="jpeg">Save as JPEG</button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="zipf-explanation-container">
          <p class="zipf-explanation">
            Zipf's law, named after linguist George Kingsley Zipf (1902-1950), states that the frequency of any word is inversely proportional to its rank in the frequency table. For example, if the most common word occurs n times, the second most common occurs n/2 times, the third most common n/3 times, etc.
          </p>
          
          <p class="zipf-explanation">
            Mathematically expressed as: f(r) ∝ 1/r<sup>α</sup>, where f(r) is the frequency of the word with rank r, and α is close to 1.
          </p>
          
          <p class="zipf-explanation">
            This visualization compares the actual vocabulary distribution (blue dots) against the ideal Zipf's Law distribution (dashed line). The phenomenon appears not only in language but across many natural and social systems, reflecting organizational principles of human behavior and information.
          </p>
          
          <div class="zipf-corpus-explanation">
            <h4>About the Cleaned Corpus</h4>
            <p>The "cleaned corpus" refers to the collection of words processed through several cleaning steps:</p>
            <ol>
              <li>Words are extracted from all posts (titles, descriptions, tags, categories)</li>
              <li>All words are converted to lowercase</li>
              <li>Punctuation and special characters are removed</li>
              <li>Very short words (2 characters or less) are filtered out</li>
              <li>Common stop words like "a", "an", "the", "and", etc. are removed</li>
            </ol>
            <p>This cleaning process is important because it removes noise that would skew the frequency analysis, normalizes text to ensure word variations are counted as the same word, and excludes common words that occur frequently but don't add much meaning.</p>
          </div>
          
          <div class="zipf-references">
            <p><strong>References:</strong></p>
            <ul>
              <li>Zipf, G. K. (1949). <em>Human Behavior and the Principle of Least Effort</em>. Addison-Wesley.</li>
              <li>Piantadosi, S. T. (2014). Zipf's word frequency law in natural language: A critical review and future directions. <em>Psychonomic Bulletin & Review</em>, 21(5), 1112-1130.</li>
              <li>Manning, C. D., & Schütze, H. (1999). <em>Foundations of Statistical Natural Language Processing</em>. MIT Press.</li>
              <li>Jäger, G. (2012). Power laws and other heavy-tailed distributions in linguistic typology. <em>Advances in Complex Systems</em>, 15(3).</li>
              <li>Ferrer-i-Cancho, R., & Solé, R. V. (2003). Least effort and the origins of scaling in human language. <em>Proceedings of the National Academy of Sciences</em>, 100(3), 788-791.</li>
            </ul>
          </div>
        </div>
      </div>
      
      <div class="zipf-table">
        <h3>Word Frequency Analysis</h3>
        <div class="table-container">
          <table id="zipf-data">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Word</th>
                <th>Freq (n/total)</th>
                <th>Pr(%)</th>
                <th>Ideal</th>
              </tr>
            </thead>
            <tbody>
              <!-- Data will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
        <div class="zipf-source">
          Source: Analysis of content from titles, descriptions, tags, and categories across all posts in this knowledge base.
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Fullscreen overlay - updated for full-screen usage -->
<div id="zipf-fullscreen-overlay" class="zipf-fullscreen-overlay">
  <div class="zipf-overlay-content">
    <div class="zipf-fullscreen-chart-wrapper">
      <div id="zipf-fullscreen-chart"></div>
      
      <!-- Fullscreen actions with same ordering as regular view -->
      <div class="zipf-fullscreen-actions">
        <!-- Fullscreen save dropdown button -->
        <div class="zipf-save-dropdown">
          <button id="zipf-fullscreen-save-button" class="zipf-save-button" aria-label="Save graph as image" aria-expanded="false" aria-controls="zipf-fullscreen-save-options">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
              <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
            </svg>
          </button>
          <div id="zipf-fullscreen-save-options" class="zipf-save-options">
            <button class="zipf-save-option" data-format="png" data-target="fullscreen">Save as PNG</button>
            <button class="zipf-save-option" data-format="svg" data-target="fullscreen">Save as SVG</button>
            <button class="zipf-save-option" data-format="jpeg" data-target="fullscreen">Save as JPEG</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Close button remains in the top right corner -->
    <button id="zipf-close-fullscreen" class="zipf-close-fullscreen" aria-label="Close fullscreen view">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
      </svg>
    </button>
  </div>
</div>

<!-- Load external JavaScript -->
{{ $zipfJS := resources.Get "js/zipfs-law.js" }}
<script src="{{ $zipfJS.RelPermalink }}"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Extract words from all posts
  const allWords = [];
  {{ range where .Site.RegularPages "Type" "in" .Site.Params.mainSections }}
    // Extract from title
    {{ $title := .Title | lower }}
    {{ $titleWords := split $title " " }}
    {{ range $titleWords }}
      allWords.push("{{ . }}");
    {{ end }}
    
    // Extract from description
    {{ with .Description }}
      {{ $desc := . | lower }}
      {{ $descWords := split $desc " " }}
      {{ range $descWords }}
        allWords.push("{{ . }}");
      {{ end }}
    {{ end }}
    
    // Extract from tags
    {{ range .Params.tags }}
      allWords.push("{{ . | lower }}");
    {{ end }}
    
    // Extract from categories
    {{ range .Params.categories }}
      allWords.push("{{ . | lower }}");
    {{ end }}
  {{ end }}
  
  // Initialize Zipf's Law visualization
  initializeZipfsLaw(allWords);
});
</script>
