{{ define "main" }}
<div class="portfolio-container">
  <!-- Portfolio Header -->
  <header class="portfolio-header">
    <h1 class="portfolio-title">{{ .Title | default "Portfolio" }}</h1>
    {{ with .Content }}
      <div class="portfolio-description">{{ . }}</div>
    {{ end }}
    
    <!-- Filter Controls -->
    <div class="portfolio-filters">
      <button class="filter-btn active" data-filter="all">All</button>
      {{ $jsonURL := (.OutputFormats.Get "JSON").Permalink }}
      {{ if $jsonURL }}
        {{ $jsonRes := resources.Get (replace $jsonURL (site.BaseURL) "") }}
        {{ with $jsonRes }}
          {{ $portfolioData := . | transform.Unmarshal }}
          {{ range $category := $portfolioData.portfolio_metadata.category_list }}
            <button class="filter-btn" data-filter="{{ $category }}">{{ humanize $category }}</button>
          {{ end }}
        {{ end }}
      {{ end }}
    </div>
    
    <!-- Stats -->
    {{ $jsonURL := (.OutputFormats.Get "JSON").Permalink }}
    {{ if $jsonURL }}
      {{ $jsonRes := resources.Get (replace $jsonURL (site.BaseURL) "") }}
      {{ with $jsonRes }}
        {{ $portfolioData := . | transform.Unmarshal }}
        <div class="portfolio-stats">
          <span class="stat-item">
            <strong>{{ $portfolioData.portfolio_metadata.total_images }}</strong> Images
          </span>
          <span class="stat-item">
            <strong>{{ len $portfolioData.portfolio_metadata.category_list }}</strong> Categories
          </span>
        </div>
      {{ end }}
    {{ end }}
  </header>

  <!-- Loading Indicator -->
  <div class="portfolio-loading">
    <div class="loading-spinner"></div>
    <p>Loading portfolio...</p>
  </div>

  <!-- Portfolio Grid -->
  <div class="portfolio-grid" id="portfolioGrid" data-json-url="{{ (.OutputFormats.Get "JSON").RelPermalink }}">
    <!-- Grid items will be dynamically inserted here -->
  </div>

  <!-- Image Overlay -->
  <div class="portfolio-overlay" id="portfolioOverlay">
    <div class="overlay-content">
      <button class="overlay-close" id="overlayClose">&times;</button>
      
      <div class="overlay-main">
        <div class="overlay-image-container">
          <img class="overlay-image" id="overlayImage" alt="">
          <div class="overlay-navigation">
            <button class="nav-btn nav-prev" id="navPrev">&#8249;</button>
            <button class="nav-btn nav-next" id="navNext">&#8250;</button>
          </div>
        </div>
        
        <aside class="overlay-sidebar">
          <div class="image-metadata">
            <h3 class="metadata-title">Image Details</h3>
            <div class="metadata-content" id="metadataContent">
              <!-- Metadata will be populated here -->
            </div>
          </div>
        </aside>
      </div>
    </div>
  </div>
</div>

<!-- Preload critical images -->
{{ $jsonURL := (.OutputFormats.Get "JSON").Permalink }}
{{ if $jsonURL }}
  {{ $jsonRes := resources.Get (replace $jsonURL (site.BaseURL) "") }}
  {{ with $jsonRes }}
    {{ $portfolioData := . | transform.Unmarshal }}
    {{ range first 6 ($portfolioData.images) }}
      <link rel="preload" as="image" href="{{ .pkb_thumbnail_300_300.url }}">
    {{ end }}
  {{ end }}
{{ end }}
{{ end }}
