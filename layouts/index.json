{{- $mainSections := .Site.Params.taxonomies.mainSections | default (slice "posts" "docs" "projects") -}}
{{- $pages := where .Site.RegularPages "Type" "in" $mainSections -}}
{{- $searchData := slice -}}

{{- range $pages -}}
  {{- if and (not .Params.private) (not .Draft) (not .Expired) -}}
    {{- $item := dict 
        "id" (.File.UniqueID | default .RelPermalink)
        "title" .Title
        "content" (.Plain | htmlUnescape | plainify | truncate 1500)
        "summary" (.Summary | htmlUnescape | plainify)
        "url" .Permalink
        "date" (.Date.Format "2006-01-02")
        "section" .Section
        "type" .Type
        "tags" (.Params.tags | default (slice))
        "categories" (.Params.categories | default (slice))
    -}}
    {{- $searchData = $searchData | append $item -}}
  {{- end -}}
{{- end -}}

{{- if eq (len $searchData) 0 -}}
  {{- $debugItem := dict 
      "id" "debug-info"
      "title" "Debug: No content found"
      "content" (printf "mainSections: %s, totalPages: %d, sections found: %s" ($mainSections | jsonify) (len .Site.RegularPages) (.Site.RegularPages | group "Type" | jsonify))
      "summary" "Search index is empty - check mainSections configuration"
      "url" "#"
      "date" now.Format "2006-01-02"
      "section" "debug"
      "type" "debug"
      "tags" (slice)
      "categories" (slice)
  -}}
  {{- $searchData = $searchData | append $debugItem -}}
{{- end -}}

{{- $searchData | jsonify -}}
